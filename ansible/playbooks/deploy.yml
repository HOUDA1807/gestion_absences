---
- name: Déploiement sur les serveurs de production
  hosts: production
  become: yes
  vars:
    package_list:
      - curl
      - git
      - nginx

  tasks:
    - name: Mettre à jour la liste des paquets
      apt:
        update_cache: yes

    - name: Installer les paquets nécessaires
      apt:
        name: "{{ item }}"
        state: present
      loop: "{{ package_list }}"
    
    - name: Démarrer le service nginx
      service:
        name: nginx
        state: started
        enabled: yes

    - name: Copier un fichier de configuration nginx
      copy:
        src: ./nginx.conf
        dest: /etc/nginx/nginx.conf
        mode: '0644'
      notify:
        - Reload nginx

  handlers:
    - name: Reload nginx
      service:
        name: nginx
        state: reloaded

